--Consulta de Clientes que han comprado un acumulado $100.000 en los últimos 60 días
SELECT P.NUM_DOCUMENTO, SUM(COSTO_RESPUSTO)
FROM PERSONA P
         INNER JOIN MANTENIMIENTO M ON (P.NUM_DOCUMENTO = M.CLIENTE_NUM_DOCUMENTO AND
                                        P.TIPO_DOCUMENTOS_ID = M.CLIENTE_TIPO_DOCUMENTOSID)
         INNER JOIN SERVICIO S ON (M.ID = S.MANTENIMIENTOID)
         INNER JOIN (SELECT S.ID, SUM(SR.COSTO_TOTAL_REPUESTO) COSTO_RESPUSTO
                     FROM SERVICIO S
                              INNER JOIN SERVICIO_REPUESTO SR ON (S.ID = SR.SERVICIO_ID)) CR ON (S.ID = CR.ID)
WHERE M.FECHA_SOLICITUD BETWEEN TO_DATE(SYSDATE - 60, 'DD/MM/YYYY') AND TO_DATE(SYSDATE, 'DD/MM/YYYY')
GROUP BY P.NUM_DOCUMENTO, P.TIPO_DOCUMENTOS_ID


--Consulta de los 100 productos más vendidos en los últimos 30 días
SELECT SR.REPUESTO_ID, SUM(SR.NUMERO_UNIDADES) AS CANT
FROM MANTENIMIENTO M
         INNER JOIN SERVICIO S ON (M.ID = S.MANTENIMIENTOID)
         INNER JOIN SERVICIO_REPUESTO SR ON (S.ID = SR.SERVICIO_ID)
WHERE M.FECHA_SOLICITUD BETWEEN TO_DATE(SYSDATE - 30, 'DD/MM/YYYY') AND TO_DATE(SYSDATE, 'DD/MM/YYYY')
  AND ROWNUM <= 100
GROUP BY SR.REPUESTO_ID
ORDER BY CANT DESC

--Consulta de las tiendas que han vendido más de 100 UND del producto 100 en los últimos 60 días.
SELECT T.NOMBRE, SUM(SR.NUMERO_UNIDADES) CANTIDAD
FROM TIENDA T
         INNER JOIN REPUESTO R ON (T.ID = R.ID_TIENDA)
         INNER JOIN SERVICIO_REPUESTO SR ON (R.ID = SR.REPUESTO_ID)
         INNER JOIN SERVICIO S ON (S.ID = SR.SERVICIO_ID)
         INNER JOIN MANTENIMIENTO M ON (M.ID = S.MANTENIMIENTOID)
WHERE R.ID = 100
  AND M.FECHA_SOLICITUD BETWEEN TO_DATE(SYSDATE - 60, 'DD/MM/YYYY') AND TO_DATE(SYSDATE, 'DD/MM/YYYY')
  AND CANTIDAD > 100

--Consulta de todos los clientes que han tenido más de un(1) mantenimento en los últimos 30 días.
SELECT P.NUM_DOCUMENTO, P.TIPO_DOCUMENTOS_ID, COUNT(*) AS CANTIDAD
FROM MANTENIMIENTO M
         INNER JOIN PERSONA P ON (M.CLIENTE_NUM_DOCUMENTO = P.NUM_DOCUMENTO AND
                                  M.CLIENTE_TIPO_DOCUMENTOSID = P.TIPO_DOCUMENTOS_ID)
WHERE M.FECHA_SOLICITUD BETWEEN TO_DATE(SYSDATE - 30, 'DD/MM/YYYY') AND TO_DATE(SYSDATE, 'DD/MM/YYYY') CANTIDAD>1
GROUP BY P.NUM_DOCUMENTO, P.TIPO_DOCUMENTOS_ID